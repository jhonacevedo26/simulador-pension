<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Pensi√≥n - Diagn√≥stico Personalizado</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0A2540;
            --primary-light: #1a3a5c;
            --accent: #00D4AA;
            --accent-dark: #00b894;
            --warning: #FF6B6B;
            --warning-yellow: #F59E0B;
            --success: #10B981;
            --bg-light: #F8FAFC;
            --bg-card: #FFFFFF;
            --text-primary: #0A2540;
            --text-secondary: #64748B;
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(10, 37, 64, 0.1), 0 2px 4px -2px rgba(10, 37, 64, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(10, 37, 64, 0.1), 0 8px 10px -6px rgba(10, 37, 64, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 20px; }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 24px;
            margin-bottom: 32px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(0, 212, 170, 0.15) 0%, transparent 70%);
            border-radius: 50%;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            color: white;
            margin-bottom: 12px;
            position: relative;
        }

        .header p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1.1rem;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        /* Progress Steps */
        .progress-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--bg-card);
            border-radius: 50px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .progress-step.active {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1) 0%, rgba(0, 212, 170, 0.05) 100%);
        }

        .progress-step.completed {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .progress-step.active .step-number { background: var(--accent); color: white; }
        .progress-step.completed .step-number { background: white; color: var(--accent); }
        .step-label { font-weight: 500; font-size: 0.9rem; }

        /* Card */
        .card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 24px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        /* Form Elements */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group.full-width { grid-column: 1 / -1; }
        .label-row { display: flex; align-items: center; gap: 8px; }
        label { font-weight: 600; font-size: 0.9rem; color: var(--text-primary); }
        .label-hint { font-weight: 400; color: var(--text-secondary); font-size: 0.8rem; }

        /* Tooltip */
        .tooltip-container { position: relative; display: inline-flex; }
        .tooltip-icon {
            width: 18px; height: 18px;
            background: var(--border);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: 700;
            color: var(--text-secondary);
            cursor: help;
            transition: all 0.3s ease;
        }
        .tooltip-icon:hover { background: var(--accent); color: white; }
        .tooltip-text {
            visibility: hidden; opacity: 0;
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%; transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.85rem; font-weight: 400;
            width: 280px;
            text-align: left;
            z-index: 100;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            line-height: 1.5;
        }
        .tooltip-text::after {
            content: '';
            position: absolute;
            top: 100%; left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--primary);
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }

        input, select {
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 212, 170, 0.1);
        }

        /* Gender Toggle */
        .gender-toggle { display: flex; gap: 12px; }
        .gender-option {
            flex: 1; padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }
        .gender-option:hover { border-color: var(--accent); }
        .gender-option.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1) 0%, rgba(0, 212, 170, 0.05) 100%);
        }
        .gender-option input { display: none; }
        .gender-icon { font-size: 2rem; margin-bottom: 8px; }
        .gender-label { font-weight: 600; }

        /* Buttons */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(0, 212, 170, 0.4);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 212, 170, 0.5); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }
        .btn-secondary:hover { border-color: var(--accent); background: white; }

        .btn-download {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(10, 37, 64, 0.3);
        }
        .btn-download:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(10, 37, 64, 0.4); }

        .btn-cta {
            background: linear-gradient(135deg, var(--warning) 0%, #e55a5a 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(255, 107, 107, 0.4);
            font-size: 1.1rem;
            padding: 18px 36px;
        }
        .btn-cta:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5); }

        .btn-group { display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap; }

        /* Results Section */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .result-card {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }
        .result-card:hover { border-color: var(--accent); transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .result-card.highlight {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.08) 0%, rgba(0, 212, 170, 0.02) 100%);
        }

        .result-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .result-icon {
            width: 44px; height: 44px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem;
        }
        .result-icon.colpensiones { background: #E8F5E9; }
        .result-icon.privado { background: #E3F2FD; }
        .result-icon.reforma { background: #FFF3E0; }

        .result-title { font-weight: 700; font-size: 0.95rem; color: var(--primary); }
        .result-subtitle { font-size: 0.8rem; color: var(--text-secondary); }
        .result-value { font-size: 1.6rem; font-weight: 700; color: var(--primary); margin-bottom: 6px; }
        .result-range { font-size: 0.9rem; color: var(--text-secondary); }

        /* Resumen Ejecutivo */
        .resumen-ejecutivo {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
        }
        .resumen-ejecutivo h3 { color: var(--accent); margin-bottom: 16px; font-size: 1.1rem; }

        .resumen-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px; }
        .resumen-item {
            text-align: center;
            padding: 16px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
        }
        .resumen-item.alerta { background: rgba(255,107,107,0.3); border: 2px solid var(--warning); }
        .resumen-item-label { font-size: 0.8rem; opacity: 0.85; margin-bottom: 6px; }
        .resumen-item-value { font-size: 1.4rem; font-weight: 700; }
        .resumen-item.alerta .resumen-item-value { color: var(--warning); }

        .alerta-box {
            background: rgba(255,107,107,0.2);
            border-left: 4px solid var(--warning);
            padding: 16px;
            border-radius: 0 12px 12px 0;
            margin-top: 16px;
        }
        .alerta-box p { margin: 0; font-size: 0.95rem; line-height: 1.6; }
        .alerta-box strong { color: var(--warning); }

        /* Sem√°foro de Urgencia */
        .semaforo-urgencia {
            padding: 20px 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .semaforo-urgencia.verde { background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); border: 2px solid var(--success); }
        .semaforo-urgencia.amarillo { background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border: 2px solid var(--warning-yellow); }
        .semaforo-urgencia.rojo { background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border: 2px solid var(--warning); }

        .semaforo-icon { font-size: 2.5rem; }
        .semaforo-content { flex: 1; }
        .semaforo-titulo { font-weight: 700; font-size: 1.1rem; margin-bottom: 4px; }
        .semaforo-urgencia.verde .semaforo-titulo { color: #065F46; }
        .semaforo-urgencia.amarillo .semaforo-titulo { color: #92400E; }
        .semaforo-urgencia.rojo .semaforo-titulo { color: #991B1B; }
        .semaforo-mensaje { font-size: 0.9rem; }
        .semaforo-urgencia.verde .semaforo-mensaje { color: #047857; }
        .semaforo-urgencia.amarillo .semaforo-mensaje { color: #B45309; }
        .semaforo-urgencia.rojo .semaforo-mensaje { color: #DC2626; }

        /* Simulador de Ahorro */
        .simulador-box {
            background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
            border: 2px solid #6366F1;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .simulador-box h4 { color: #4338CA; margin-bottom: 16px; font-size: 1.1rem; }

        .simulador-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .simulador-input-group { display: flex; flex-direction: column; gap: 6px; }
        .simulador-input-group label { font-size: 0.85rem; color: #4338CA; font-weight: 600; }
        .simulador-input-group input {
            padding: 12px;
            border: 2px solid #A5B4FC;
            border-radius: 10px;
            background: white;
        }
        .simulador-input-group input:focus { border-color: #6366F1; }

        .simulador-resultado {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .simulador-resultado-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .simulador-stat { padding: 12px; }
        .simulador-stat-value { font-size: 1.5rem; font-weight: 700; color: #4338CA; }
        .simulador-stat-label { font-size: 0.8rem; color: var(--text-secondary); }

        /* Brecha Card */
        .brecha-card {
            background: linear-gradient(135deg, var(--warning) 0%, #ee5a5a 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }
        .brecha-card h3 { font-size: 1rem; margin-bottom: 8px; opacity: 0.9; }
        .brecha-value { font-size: 2.2rem; font-weight: 700; margin-bottom: 10px; }
        .brecha-text { font-size: 0.9rem; opacity: 0.9; max-width: 450px; margin: 0 auto; }
        .porcentaje-reduccion {
            display: inline-block;
            background: rgba(0,0,0,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 12px;
            font-size: 0.9rem;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1) 0%, rgba(0, 212, 170, 0.05) 100%);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .info-box h4 { color: var(--accent-dark); margin-bottom: 12px; font-size: 1.1rem; }
        .info-box p { margin-bottom: 16px; color: var(--text-primary); }

        .estrategias-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .estrategia-tag {
            background: white;
            border: 1px solid var(--accent);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--accent-dark);
            font-weight: 500;
        }

        /* CTA Box */
        .cta-box {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 28px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 24px;
        }
        .cta-box h4 { margin-bottom: 10px; font-size: 1.2rem; }
        .cta-box p { opacity: 0.9; font-size: 0.95rem; margin-bottom: 20px; }

        /* Summary Stats */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        .stat-item {
            text-align: center;
            padding: 16px;
            background: var(--bg-light);
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px; }

        /* Datos entrada box */
        .datos-entrada-box {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        .datos-entrada-box h4 { font-size: 0.9rem; margin-bottom: 12px; color: var(--primary); }
        .datos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
        }
        .dato-item { display: flex; justify-content: space-between; font-size: 0.85rem; }
        .dato-label { color: var(--text-secondary); }
        .dato-value { font-weight: 600; color: var(--primary); }

        /* Disclaimer & Footer */
        .disclaimer {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 0.8rem;
            color: #92400E;
            margin-top: 24px;
        }
        .disclaimer-title { font-weight: 700; margin-bottom: 6px; }

        .footer-creditos {
            text-align: center;
            padding: 24px;
            margin-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        .footer-creditos a {
            color: var(--accent-dark);
            text-decoration: none;
            font-weight: 600;
        }
        .footer-creditos a:hover { text-decoration: underline; }
        .footer-disclaimer {
            font-size: 0.75rem;
            margin-top: 12px;
            color: #94A3B8;
            line-height: 1.5;
        }

        /* Hidden & Utils */
        .hidden { display: none !important; }
        .spinner {
            width: 20px; height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 600px) {
            .container { padding: 12px; }
            .card { padding: 20px; }
            .header { padding: 30px 16px; }
            .progress-step { padding: 8px 14px; }
            .step-label { display: none; }
            .btn { width: 100%; }
            .btn-group { flex-direction: column; }
            .gender-toggle { flex-direction: column; }
            .resumen-grid { grid-template-columns: 1fr; }
            .tooltip-text { width: 220px; left: 0; transform: translateX(0); }
            .semaforo-urgencia { flex-direction: column; text-align: center; }
        }

        /* Print Styles */
        @media print {
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            body { background: white !important; font-size: 11px; }
            .container { max-width: 100%; padding: 0; margin: 0; }
            .no-print { display: none !important; }
            .header, .progress-container { display: none !important; }
            .card { box-shadow: none; border-radius: 0; padding: 20px; margin: 0; page-break-inside: avoid; }
            .btn-group { display: none !important; }
            @page { margin: 1cm; size: A4; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header no-print">
            <h1>üìä Calculadora de Pensi√≥n</h1>
            <p>Descubre cu√°nto recibir√°s en tu jubilaci√≥n y c√≥mo prepararte para el futuro</p>
        </header>

        <!-- Progress Steps -->
        <div class="progress-container no-print">
            <div class="progress-step active" id="progress-1">
                <span class="step-number">1</span>
                <span class="step-label">Datos Personales</span>
            </div>
            <div class="progress-step" id="progress-2">
                <span class="step-number">2</span>
                <span class="step-label">Datos Laborales</span>
            </div>
            <div class="progress-step" id="progress-3">
                <span class="step-number">3</span>
                <span class="step-label">Diagn√≥stico</span>
            </div>
        </div>

        <!-- Step 1: Datos Personales -->
        <div class="card" id="step1">
            <h2 class="card-title">
                <span class="card-title-icon">üë§</span>
                Datos Personales
            </h2>
            <div class="form-grid">
                <div class="form-group full-width">
                    <div class="label-row">
                        <label>Nombre completo</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Ingresa tu nombre completo. Esto nos ayuda a personalizar tu diagn√≥stico.</span>
                        </div>
                    </div>
                    <input type="text" id="nombre" placeholder="Ej: Juan P√©rez Garc√≠a" required>
                </div>
                <div class="form-group">
                    <div class="label-row">
                        <label>Correo electr√≥nico</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Tu correo para enviarte informaci√≥n adicional sobre estrategias de ahorro.</span>
                        </div>
                    </div>
                    <input type="email" id="email" placeholder="tucorreo@ejemplo.com" required>
                </div>
                <div class="form-group">
                    <div class="label-row">
                        <label>Tel√©fono</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">N√∫mero de contacto para brindarte asesor√≠a personalizada.</span>
                        </div>
                    </div>
                    <input type="tel" id="telefono" placeholder="300 123 4567" required>
                </div>
                <div class="form-group full-width">
                    <div class="label-row">
                        <label>G√©nero</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text"><strong>Importante:</strong> La edad de pensi√≥n var√≠a. Hombres: 62 a√±os. Mujeres: 57 a√±os, con beneficios adicionales por hijos.</span>
                        </div>
                    </div>
                    <div class="gender-toggle">
                        <label class="gender-option" id="gender-hombre">
                            <input type="radio" name="genero" value="Hombre">
                            <div class="gender-icon">üë®</div>
                            <div class="gender-label">Hombre</div>
                            <div class="label-hint">Pensi√≥n a los 62 a√±os</div>
                        </label>
                        <label class="gender-option" id="gender-mujer">
                            <input type="radio" name="genero" value="Mujer">
                            <div class="gender-icon">üë©</div>
                            <div class="gender-label">Mujer</div>
                            <div class="label-hint">Pensi√≥n a los 57 a√±os</div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="label-row">
                        <label>Edad actual</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Tu edad en a√±os cumplidos para calcular cu√°ntos a√±os te faltan para pensionarte.</span>
                        </div>
                    </div>
                    <input type="number" id="edad" placeholder="35" min="18" max="70" required>
                </div>
                <div class="form-group hidden" id="hijos-container">
                    <div class="label-row">
                        <label>N√∫mero de hijos</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text"><strong>Beneficio mujeres:</strong> -50 semanas por hijo (m√°x 3 hijos = 150 semanas menos).</span>
                        </div>
                    </div>
                    <select id="hijos">
                        <option value="0">0 hijos</option>
                        <option value="1">1 hijo</option>
                        <option value="2">2 hijos</option>
                        <option value="3">3 hijos o m√°s</option>
                    </select>
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="goToStep(2)">Continuar <span>‚Üí</span></button>
            </div>
        </div>

        <!-- Step 2: Datos Laborales -->
        <div class="card hidden" id="step2">
            <h2 class="card-title">
                <span class="card-title-icon">üíº</span>
                Datos Laborales y Pensionales
            </h2>
            <div class="form-grid">
                <div class="form-group">
                    <div class="label-row">
                        <label>IBL (Ingreso Base de Liquidaci√≥n)</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text"><strong>IBL:</strong> Promedio de salarios de los √∫ltimos 10 a√±os. Si no lo conoces, usa tu salario actual. Cons√∫ltalo en tu historia laboral de Colpensiones.</span>
                        </div>
                    </div>
                    <input type="text" id="ibl" placeholder="$5.000.000" required>
                </div>
                <div class="form-group">
                    <div class="label-row">
                        <label>Semanas cotizadas</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text"><strong>Semanas:</strong> Total aportado a pensi√≥n. Cons√∫ltalo en Colpensiones o tu fondo. 1 a√±o ‚âà 52 semanas.</span>
                        </div>
                    </div>
                    <input type="number" id="semanas" placeholder="800" min="0" max="3000" required>
                </div>
                <div class="form-group">
                    <div class="label-row">
                        <label>Salario M√≠nimo 2026</label>
                        <div class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text"><strong>SMLV:</strong> Se usa para calcular tasa de reemplazo y topes. Ed√≠talo si cambia.</span>
                        </div>
                    </div>
                    <input type="text" id="smlv" value="$1.750.905">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="goToStep(1)"><span>‚Üê</span> Atr√°s</button>
                <button class="btn btn-primary" onclick="calcularPension()" id="btn-calcular">Ver mi diagn√≥stico <span>üìä</span></button>
            </div>
        </div>

        <!-- Step 3: Resultados -->
        <div class="card hidden" id="step3">
            <div id="resultados-content">
                
                <h2 class="card-title no-print">
                    <span class="card-title-icon">üìã</span>
                    Tu Diagn√≥stico Pensional
                </h2>

                <p style="margin-bottom: 16px; color: var(--text-secondary);">
                    Diagn√≥stico para: <strong id="res-nombre" style="color: var(--primary);"></strong>
                </p>

                <!-- SEM√ÅFORO DE URGENCIA -->
                <div class="semaforo-urgencia verde" id="semaforo">
                    <div class="semaforo-icon" id="semaforo-icon">üü¢</div>
                    <div class="semaforo-content">
                        <div class="semaforo-titulo" id="semaforo-titulo">Vas por buen camino</div>
                        <div class="semaforo-mensaje" id="semaforo-mensaje">Tu brecha es manejable, pero no te conf√≠es. Es momento de optimizar tu estrategia.</div>
                    </div>
                </div>

                <!-- RESUMEN EJECUTIVO -->
                <div class="resumen-ejecutivo">
                    <h3>‚ö° RESUMEN EJECUTIVO</h3>
                    <div class="resumen-grid">
                        <div class="resumen-item">
                            <div class="resumen-item-label">Ingreso Actual</div>
                            <div class="resumen-item-value" id="res-ingreso-actual">$0</div>
                        </div>
                        <div class="resumen-item">
                            <div class="resumen-item-label">Mejor Pensi√≥n Estimada</div>
                            <div class="resumen-item-value" id="res-mejor-pension">$0</div>
                        </div>
                        <div class="resumen-item alerta">
                            <div class="resumen-item-label">Brecha Mensual</div>
                            <div class="resumen-item-value" id="res-brecha-resumen">-$0</div>
                        </div>
                    </div>
                    <div class="alerta-box">
                        <p>
                            <strong>‚ö†Ô∏è ATENCI√ìN:</strong> Al pensionarte, tu ingreso pasar√° de <strong id="res-de"></strong> a aproximadamente <strong id="res-a"></strong>. 
                            Esto representa una <strong>reducci√≥n del <span id="res-porcentaje">0</span>%</strong> en tu capacidad econ√≥mica mensual.
                        </p>
                    </div>
                </div>

                <!-- Datos de entrada -->
                <div class="datos-entrada-box">
                    <h4>üìã Datos de Entrada</h4>
                    <div class="datos-grid">
                        <div class="dato-item">
                            <span class="dato-label">G√©nero:</span>
                            <span class="dato-value" id="res-genero">-</span>
                        </div>
                        <div class="dato-item">
                            <span class="dato-label">Edad actual:</span>
                            <span class="dato-value" id="res-edad">- a√±os</span>
                        </div>
                        <div class="dato-item">
                            <span class="dato-label">IBL:</span>
                            <span class="dato-value" id="res-ibl">$0</span>
                        </div>
                        <div class="dato-item">
                            <span class="dato-label">Semanas cotizadas:</span>
                            <span class="dato-value" id="res-semanas">0</span>
                        </div>
                        <div class="dato-item" id="res-hijos-container" style="display: none;">
                            <span class="dato-label">Hijos (beneficio):</span>
                            <span class="dato-value" id="res-hijos">0</span>
                        </div>
                        <div class="dato-item">
                            <span class="dato-label">SMLV usado:</span>
                            <span class="dato-value" id="res-smlv">$0</span>
                        </div>
                    </div>
                </div>

                <!-- Situaci√≥n pensional -->
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="res-edad-pension">62</div>
                        <div class="stat-label">Edad de pensi√≥n</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="res-anos-restantes">27</div>
                        <div class="stat-label">A√±os restantes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="res-semanas-actuales">500</div>
                        <div class="stat-label">Semanas actuales</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="res-semanas-proyectadas">1,800</div>
                        <div class="stat-label">Semanas proyectadas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="res-ano-pension">2050</div>
                        <div class="stat-label">A√±o de pensi√≥n</div>
                    </div>
                </div>

                <!-- Comparativo de Escenarios -->
                <h3 style="margin-bottom: 16px; color: var(--primary); font-size: 1.1rem;">üí∞ Comparativo de Escenarios</h3>
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-icon colpensiones">üèõÔ∏è</div>
                            <div>
                                <div class="result-title">Colpensiones</div>
                                <div class="result-subtitle">R√©gimen de Prima Media</div>
                            </div>
                        </div>
                        <div class="result-value" id="res-colpensiones">$0</div>
                        <div class="result-range">Tasa base (R): <span id="res-tasa-r">0%</span></div>
                        <div class="result-range">Adicional (<span id="res-bloques">0</span> bloques): <span id="res-adicional">+0%</span></div>
                        <div class="result-range" style="font-weight: 600; color: var(--primary); margin-top: 4px;">Tasa final: <span id="res-tasa-colp">0%</span></div>
                    </div>

                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-icon privado">üè¶</div>
                            <div>
                                <div class="result-title">Fondo Privado</div>
                                <div class="result-subtitle">Ahorro Individual (RAIS)</div>
                            </div>
                        </div>
                        <div class="result-value" id="res-privado-optimista">$0</div>
                        <div class="result-range">Rango: <span id="res-privado-conservador">$0</span> - <span id="res-privado-optimista-2">$0</span></div>
                        <div class="result-range" style="font-size: 0.8rem; margin-top: 8px; color: var(--text-secondary);">
                            *Estimaci√≥n hist√≥rica. Var√≠a seg√∫n capital acumulado y condiciones del afiliado.
                        </div>
                    </div>

                    <div class="result-card highlight">
                        <div class="result-header">
                            <div class="result-icon reforma">‚öñÔ∏è</div>
                            <div>
                                <div class="result-title">Reforma Pensional</div>
                                <div class="result-subtitle">Sistema Mixto</div>
                            </div>
                        </div>
                        <div class="result-value" id="res-reforma-optimista">$0</div>
                        <div class="result-range">Rango: <span id="res-reforma-conservador">$0</span> - <span id="res-reforma-optimista-2">$0</span></div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); font-size: 0.8rem;">
                            <div>Parte Colpensiones (2.5 SMLV): <strong id="res-reforma-colp">$0</strong></div>
                            <div>Parte Privado (excedente): <strong id="res-reforma-priv">$0 - $0</strong></div>
                        </div>
                    </div>
                </div>

                <!-- Brecha Pensional destacada -->
                <div class="brecha-card">
                    <h3>‚ö†Ô∏è Tu Brecha Pensional Mensual</h3>
                    <div class="brecha-value" id="res-brecha">-$0</div>
                    <p class="brecha-text">Esta es la diferencia entre tu ingreso actual y tu mejor pensi√≥n estimada. Para mantener tu calidad de vida, necesitas cubrir esta brecha.</p>
                    <div class="porcentaje-reduccion">
                        üìâ Reducci√≥n del <strong id="res-porcentaje-2">0</strong>% de tu ingreso
                    </div>
                </div>

                <!-- SIMULADOR DE AHORRO -->
                <div class="simulador-box">
                    <h4>üßÆ Simulador de Ahorro e Inversi√≥n</h4>
                    <p style="font-size: 0.9rem; color: #4338CA; margin-bottom: 16px;">¬øCu√°nto necesitas ahorrar para cerrar tu brecha pensional? Ajusta los valores y desc√∫brelo:</p>
                    
                    <div class="simulador-grid">
                        <div class="simulador-input-group">
                            <label>Ahorro mensual</label>
                            <input type="text" id="sim-ahorro" value="$500.000" oninput="formatSimuladorInput(this); calcularSimulador()">
                        </div>
                        <div class="simulador-input-group">
                            <label>A√±os de ahorro</label>
                            <input type="number" id="sim-anos" value="20" min="1" max="50" onchange="calcularSimulador()">
                        </div>
                        <div class="simulador-input-group">
                            <label>Rentabilidad anual (%)</label>
                            <input type="number" id="sim-tasa" value="8" min="1" max="20" step="0.5" onchange="calcularSimulador()">
                        </div>
                    </div>

                    <div class="simulador-resultado">
                        <div class="simulador-resultado-grid">
                            <div class="simulador-stat">
                                <div class="simulador-stat-value" id="sim-capital">$0</div>
                                <div class="simulador-stat-label">Capital acumulado</div>
                            </div>
                            <div class="simulador-stat">
                                <div class="simulador-stat-value" id="sim-renta">$0</div>
                                <div class="simulador-stat-label">Renta mensual estimada*</div>
                            </div>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 12px;">*Renta calculada al 4% anual sobre el capital (retiro sostenible)</p>
                    </div>
                </div>

                <!-- Recomendaci√≥n -->
                <div class="info-box">
                    <h4>üí° ¬øC√≥mo cerrar esta brecha?</h4>
                    <p>Te recomiendo que dise√±es un <strong>plan financiero</strong> y un <strong>plan de inversiones</strong> que te permitan estructurar tus finanzas de manera adecuada. Para eso, un buen comienzo es tener una <strong>asesor√≠a profesional</strong>.</p>
                    <p style="margin-top: 12px; margin-bottom: 12px;">Adicionalmente, tienes estas opciones para que eval√∫es c√≥mo cerrar tu brecha pensional:</p>
                    <div class="estrategias-grid">
                        <span class="estrategia-tag">1. Seguros con acumulaci√≥n de capital</span>
                        <span class="estrategia-tag">2. Fondos de inversi√≥n</span>
                        <span class="estrategia-tag">3. Pensi√≥n voluntaria</span>
                        <span class="estrategia-tag">4. Propiedad ra√≠z</span>
                        <span class="estrategia-tag">5. Portafolio de rentas</span>
                        <span class="estrategia-tag">6. Capital privado</span>
                    </div>
                    <p style="margin-top: 16px; font-weight: 600; color: var(--primary);">¬øQuieres m√°s informaci√≥n? Busca asesor√≠a con un profesional certificado y vigilado.</p>
                </div>

                <!-- CTA -->
                <div class="cta-box">
                    <h4>¬øQuieres un plan personalizado para asegurar tu retiro?</h4>
                    <p>Agenda una asesor√≠a con un experto y descubre las mejores alternativas de inversi√≥n para tu perfil.</p>
                    <button class="btn btn-cta" onclick="solicitarAsesoria()">
                        <span>üìû</span> Quiero Asesor√≠a
                    </button>
                </div>

                <!-- Disclaimer -->
                <div class="disclaimer">
                    <div class="disclaimer-title">‚ö†Ô∏è Aviso Legal</div>
                    <p>Esta es una proyecci√≥n estimada con fines educativos. Las condiciones laborales, normativas y reformas pensionales pueden cambiar. Este c√°lculo no constituye asesor√≠a financiera formal. Los porcentajes del fondo privado (40%-45%) son estimaciones conservadoras basadas en promedios hist√≥ricos. Consulta con un profesional certificado para decisiones importantes sobre tu pensi√≥n.</p>
                </div>
            </div>

            <div class="btn-group no-print">
                <button class="btn btn-secondary" onclick="goToStep(2)"><span>‚Üê</span> Modificar datos</button>
                <button class="btn btn-download" onclick="imprimirDiagnostico()"><span>üñ®Ô∏è</span> Imprimir / Guardar PDF</button>
            </div>
        </div>

        <!-- Footer con cr√©ditos -->
        <footer class="footer-creditos">
            <p>Desarrollado por <a href="https://instagram.com/jhonanaliza" target="_blank">@jhonanaliza</a></p>
            <p class="footer-disclaimer">
                Esta herramienta es solo para fines educativos e informativos. No constituye asesor√≠a financiera, legal o de inversiones. 
                El creador no se hace responsable por decisiones tomadas bas√°ndose en los resultados de esta calculadora. 
                Siempre consulta con profesionales certificados y vigilados antes de tomar decisiones financieras importantes.
            </p>
        </footer>
    </div>

    <script>
        // Google Sheets endpoint
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzX-LMsgHtUd30MaSoJQoECfAe8X2Y-8ICJFGpBvUF9rjuIUv4gpg2MsB6Yg-10R1HUmw/exec';

        let resultadosCalculados = {};

        // Formatear moneda
        function formatCurrency(num) {
            return '$' + Math.round(num).toLocaleString('es-CO');
        }

        // Parsear moneda
        function parseCurrency(str) {
            return parseInt(str.replace(/[^\d]/g, '')) || 0;
        }

        // Formatear input moneda
        function formatCurrencyInput(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                input.value = '$' + parseInt(value).toLocaleString('es-CO');
            }
        }

        function formatSimuladorInput(input) {
            formatCurrencyInput(input);
        }

        // Event listeners
        document.getElementById('ibl').addEventListener('input', function() { formatCurrencyInput(this); });
        document.getElementById('smlv').addEventListener('input', function() { formatCurrencyInput(this); });

        document.querySelectorAll('.gender-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.gender-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                this.querySelector('input').checked = true;
                const hijosContainer = document.getElementById('hijos-container');
                if (this.querySelector('input').value === 'Mujer') {
                    hijosContainer.classList.remove('hidden');
                } else {
                    hijosContainer.classList.add('hidden');
                }
            });
        });

        // Navegaci√≥n
        function goToStep(step) {
            if (step === 2 && !validarPaso1()) return;
            document.querySelectorAll('.card').forEach(card => card.classList.add('hidden'));
            document.getElementById('step' + step).classList.remove('hidden');
            for (let i = 1; i <= 3; i++) {
                const progressStep = document.getElementById('progress-' + i);
                progressStep.classList.remove('active', 'completed');
                if (i < step) progressStep.classList.add('completed');
                else if (i === step) progressStep.classList.add('active');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validarPaso1() {
            const nombre = document.getElementById('nombre').value.trim();
            const email = document.getElementById('email').value.trim();
            const telefono = document.getElementById('telefono').value.trim();
            const genero = document.querySelector('input[name="genero"]:checked');
            const edad = document.getElementById('edad').value;
            if (!nombre) { alert('Ingresa tu nombre completo'); return false; }
            if (!email || !email.includes('@')) { alert('Ingresa un correo v√°lido'); return false; }
            if (!telefono) { alert('Ingresa tu tel√©fono'); return false; }
            if (!genero) { alert('Selecciona tu g√©nero'); return false; }
            if (!edad || edad < 18 || edad > 70) { alert('Ingresa una edad v√°lida (18-70)'); return false; }
            return true;
        }

        function validarPaso2() {
            const ibl = parseCurrency(document.getElementById('ibl').value);
            const semanas = parseInt(document.getElementById('semanas').value);
            const smlv = parseCurrency(document.getElementById('smlv').value);
            if (!ibl) { alert('Ingresa tu IBL'); return false; }
            if (isNaN(semanas) || semanas < 0) { alert('Ingresa tus semanas cotizadas'); return false; }
            if (!smlv) { alert('Verifica el salario m√≠nimo'); return false; }
            return true;
        }

        function calcularSemanasRequeridasMujer(anoPension, hijos) {
            const anoBase = 2025, semanasBase = 1300, reduccionPorAno = 25, semanasMinimas = 1000;
            let anosTranscurridos = Math.max(0, anoPension - anoBase);
            let semanasAno = Math.max(semanasMinimas, semanasBase - (anosTranscurridos * reduccionPorAno));
            return Math.max(850, semanasAno - (Math.min(hijos, 3) * 50));
        }

        function calcularPension() {
            if (!validarPaso2()) return;
            const btn = document.getElementById('btn-calcular');
            btn.innerHTML = '<span class="spinner"></span> Calculando...';
            btn.disabled = true;

            const nombre = document.getElementById('nombre').value.trim();
            const email = document.getElementById('email').value.trim();
            const telefono = document.getElementById('telefono').value.trim();
            const genero = document.querySelector('input[name="genero"]:checked').value;
            const edad = parseInt(document.getElementById('edad').value);
            const hijos = genero === 'Mujer' ? parseInt(document.getElementById('hijos').value) : 0;
            const ibl = parseCurrency(document.getElementById('ibl').value);
            const semanasCotizadas = parseInt(document.getElementById('semanas').value);
            const smlv = parseCurrency(document.getElementById('smlv').value);

            const edadPension = genero === 'Hombre' ? 62 : 57;
            const anosRestantes = Math.max(0, edadPension - edad);
            const anoActual = 2026;
            const anoPension = anoActual + anosRestantes;

            let semanasRequeridas = genero === 'Hombre' ? 1300 : calcularSemanasRequeridasMujer(anoPension, hijos);
            
            // Proyectar semanas a la edad de pensi√≥n
            const semanasProyectadas = semanasCotizadas + (anosRestantes * 52);
            const semanasFaltantes = Math.max(0, semanasRequeridas - semanasCotizadas);

            // CASO 1: COLPENSIONES
            const S = ibl / smlv;
            let R = 65.5 - (0.5 * S);
            const semanasParaCalculo = Math.min(semanasProyectadas, 1800);
            const semanasBase = 1300;
            const semanasAdicionales = Math.max(0, semanasParaCalculo - semanasBase);
            const bloques = Math.floor(semanasAdicionales / 50);
            const adicional = bloques * 1.5;
            const tasaFinalColp = R + adicional;
            let pensionColpensiones = ibl * (tasaFinalColp / 100);
            const pensionMinima = smlv;
            const pensionMaxima = smlv * 25;
            pensionColpensiones = Math.max(pensionMinima, Math.min(pensionMaxima, pensionColpensiones));

            // CASO 2: FONDO PRIVADO
            let pensionPrivadoConservador = ibl * 0.40;
            let pensionPrivadoOptimista = ibl * 0.45;
            pensionPrivadoConservador = Math.max(pensionMinima, Math.min(pensionMaxima, pensionPrivadoConservador));
            pensionPrivadoOptimista = Math.max(pensionMinima, Math.min(pensionMaxima, pensionPrivadoOptimista));

            // CASO 3: REFORMA
            const iblReformaColp = Math.min(ibl, smlv * 2.5);
            const iblReformaPriv = Math.max(0, ibl - (smlv * 2.5));
            const S_reforma = iblReformaColp / smlv;
            const R_reforma = 65.5 - (0.5 * S_reforma);
            const tasaFinalReformaColp = R_reforma + adicional;
            let pensionReformaColp = iblReformaColp * (tasaFinalReformaColp / 100);
            let pensionReformaPrivConservador = iblReformaPriv * 0.40;
            let pensionReformaPrivOptimista = iblReformaPriv * 0.45;
            let pensionReformaTotalConservador = pensionReformaColp + pensionReformaPrivConservador;
            let pensionReformaTotalOptimista = pensionReformaColp + pensionReformaPrivOptimista;
            pensionReformaTotalConservador = Math.max(pensionMinima, Math.min(pensionMaxima, pensionReformaTotalConservador));
            pensionReformaTotalOptimista = Math.max(pensionMinima, Math.min(pensionMaxima, pensionReformaTotalOptimista));

            const mejorPension = Math.max(pensionColpensiones, pensionPrivadoOptimista, pensionReformaTotalOptimista);
            const brechaPensional = ibl - mejorPension;
            const porcentajeReduccion = ((brechaPensional / ibl) * 100).toFixed(0);

            resultadosCalculados = {
                nombre, email, telefono, genero, edad, hijos, ibl, semanasCotizadas, smlv,
                semanasProyectadas,
                pensionColpensiones: Math.round(pensionColpensiones),
                pensionPrivadoConservador: Math.round(pensionPrivadoConservador),
                pensionPrivadoOptimista: Math.round(pensionPrivadoOptimista),
                pensionReformaConservador: Math.round(pensionReformaTotalConservador),
                pensionReformaOptimista: Math.round(pensionReformaTotalOptimista),
                brechaPensional: Math.round(brechaPensional),
                anoEstimadoPension: anoPension,
                semanasRequeridas, semanasFaltantes, edadPension, anosRestantes,
                R, adicional, tasaFinalColp, bloques,
                pensionReformaColp: Math.round(pensionReformaColp),
                pensionReformaPrivConservador: Math.round(pensionReformaPrivConservador),
                pensionReformaPrivOptimista: Math.round(pensionReformaPrivOptimista),
                mejorPension: Math.round(mejorPension),
                porcentajeReduccion,
                quiereAsesoria: 'No'
            };

            enviarAGoogleSheets(resultadosCalculados)
                .then(() => { mostrarResultados(resultadosCalculados); goToStep(3); })
                .catch(() => { mostrarResultados(resultadosCalculados); goToStep(3); })
                .finally(() => { btn.innerHTML = 'Ver mi diagn√≥stico <span>üìä</span>'; btn.disabled = false; });
        }

        async function enviarAGoogleSheets(datos) {
            try {
                await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST', mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
            } catch (e) { console.error(e); }
        }

        function mostrarResultados(res) {
            // Sem√°foro de urgencia
            const porcentaje = Math.abs(parseInt(res.porcentajeReduccion));
            const semaforo = document.getElementById('semaforo');
            const semaforoIcon = document.getElementById('semaforo-icon');
            const semaforoTitulo = document.getElementById('semaforo-titulo');
            const semaforoMensaje = document.getElementById('semaforo-mensaje');

            semaforo.classList.remove('verde', 'amarillo', 'rojo');
            if (porcentaje <= 20) {
                semaforo.classList.add('verde');
                semaforoIcon.textContent = 'üü¢';
                semaforoTitulo.textContent = 'Vas por buen camino';
                semaforoMensaje.textContent = 'Tu brecha es manejable, pero no te conf√≠es. Es momento de optimizar tu estrategia para asegurar tu retiro.';
            } else if (porcentaje <= 40) {
                semaforo.classList.add('amarillo');
                semaforoIcon.textContent = 'üü°';
                semaforoTitulo.textContent = 'Necesitas actuar pronto';
                semaforoMensaje.textContent = 'Tu brecha pensional es significativa. Sin acci√≥n, tu calidad de vida en el retiro podr√≠a verse afectada.';
            } else {
                semaforo.classList.add('rojo');
                semaforoIcon.textContent = 'üî¥';
                semaforoTitulo.textContent = 'URGENTE: Tu calidad de vida est√° en riesgo';
                semaforoMensaje.textContent = 'Tu brecha es cr√≠tica. Necesitas una estrategia de acumulaci√≥n agresiva lo antes posible para evitar problemas financieros en tu retiro.';
            }

            // Resumen ejecutivo
            document.getElementById('res-ingreso-actual').textContent = formatCurrency(res.ibl);
            document.getElementById('res-mejor-pension').textContent = formatCurrency(res.mejorPension);
            document.getElementById('res-brecha-resumen').textContent = '-' + formatCurrency(Math.abs(res.brechaPensional));
            document.getElementById('res-de').textContent = formatCurrency(res.ibl);
            document.getElementById('res-a').textContent = formatCurrency(res.mejorPension);
            document.getElementById('res-porcentaje').textContent = Math.abs(res.porcentajeReduccion);

            // Datos entrada
            document.getElementById('res-nombre').textContent = res.nombre;
            document.getElementById('res-genero').textContent = res.genero;
            document.getElementById('res-edad').textContent = res.edad + ' a√±os';
            document.getElementById('res-ibl').textContent = formatCurrency(res.ibl);
            document.getElementById('res-semanas').textContent = res.semanasCotizadas.toLocaleString('es-CO');
            document.getElementById('res-smlv').textContent = formatCurrency(res.smlv);
            if (res.genero === 'Mujer') {
                document.getElementById('res-hijos-container').style.display = 'flex';
                document.getElementById('res-hijos').textContent = res.hijos;
            }

            // Situaci√≥n
            document.getElementById('res-edad-pension').textContent = res.edadPension;
            document.getElementById('res-anos-restantes').textContent = res.anosRestantes;
            document.getElementById('res-semanas-actuales').textContent = res.semanasCotizadas.toLocaleString('es-CO');
            document.getElementById('res-semanas-proyectadas').textContent = Math.min(res.semanasProyectadas, 1800).toLocaleString('es-CO');
            document.getElementById('res-ano-pension').textContent = res.anoEstimadoPension;

            // Escenarios
            document.getElementById('res-colpensiones').textContent = formatCurrency(res.pensionColpensiones);
            document.getElementById('res-tasa-r').textContent = res.R.toFixed(2) + '%';
            document.getElementById('res-bloques').textContent = res.bloques;
            document.getElementById('res-adicional').textContent = '+' + res.adicional.toFixed(1) + '%';
            document.getElementById('res-tasa-colp').textContent = res.tasaFinalColp.toFixed(2) + '%';

            document.getElementById('res-privado-optimista').textContent = formatCurrency(res.pensionPrivadoOptimista);
            document.getElementById('res-privado-conservador').textContent = formatCurrency(res.pensionPrivadoConservador);
            document.getElementById('res-privado-optimista-2').textContent = formatCurrency(res.pensionPrivadoOptimista);

            document.getElementById('res-reforma-optimista').textContent = formatCurrency(res.pensionReformaOptimista);
            document.getElementById('res-reforma-conservador').textContent = formatCurrency(res.pensionReformaConservador);
            document.getElementById('res-reforma-optimista-2').textContent = formatCurrency(res.pensionReformaOptimista);
            document.getElementById('res-reforma-colp').textContent = formatCurrency(res.pensionReformaColp);
            document.getElementById('res-reforma-priv').textContent = formatCurrency(res.pensionReformaPrivConservador) + ' - ' + formatCurrency(res.pensionReformaPrivOptimista);

            // Brecha
            document.getElementById('res-brecha').textContent = '-' + formatCurrency(Math.abs(res.brechaPensional));
            document.getElementById('res-porcentaje-2').textContent = Math.abs(res.porcentajeReduccion);

            // Simulador - valores iniciales basados en a√±os restantes
            document.getElementById('sim-anos').value = res.anosRestantes;
            calcularSimulador();
        }

        // Simulador de Ahorro
        function calcularSimulador() {
            const ahorroMensual = parseCurrency(document.getElementById('sim-ahorro').value);
            const anos = parseInt(document.getElementById('sim-anos').value) || 20;
            const tasaAnual = parseFloat(document.getElementById('sim-tasa').value) || 8;

            const tasaMensual = tasaAnual / 100 / 12;
            const meses = anos * 12;

            // F√≥rmula de valor futuro de anualidad
            let capitalFinal = 0;
            if (tasaMensual > 0) {
                capitalFinal = ahorroMensual * ((Math.pow(1 + tasaMensual, meses) - 1) / tasaMensual);
            } else {
                capitalFinal = ahorroMensual * meses;
            }

            // Renta mensual al 4% anual (regla del 4%)
            const rentaMensual = (capitalFinal * 0.04) / 12;

            document.getElementById('sim-capital').textContent = formatCurrency(capitalFinal);
            document.getElementById('sim-renta').textContent = formatCurrency(rentaMensual);
        }

        // Solicitar Asesor√≠a
        function solicitarAsesoria() {
            // Actualizar el registro en Google Sheets
            resultadosCalculados.quiereAsesoria = 'S√≠';
            
            enviarAGoogleSheets(resultadosCalculados)
                .then(() => {
                    alert('¬°Gracias por tu inter√©s! Un asesor se pondr√° en contacto contigo pronto.');
                })
                .catch(() => {
                    alert('¬°Gracias por tu inter√©s! Un asesor se pondr√° en contacto contigo pronto.');
                });
        }

        function imprimirDiagnostico() {
            window.print();
        }

        // Inicializar simulador
        document.addEventListener('DOMContentLoaded', function() {
            calcularSimulador();
        });
    </script>
</body>
</html>
